angular.module("selectionModel",[]),angular.module("selectionModel").directive("selectionModel",["selectionStack","uuidGen","selectionModelOptions",function(a,b,c){"use strict";return{restrict:"A",link:function(d,e,f){var g=c.get(),h=g.selectedAttribute,i=g.selectedClass,j=g.type,k=g.mode,l=g.cleanupStrategy,m=f.selectionModelType||j,n=f.selectionModelMode||k,o=/^multi(ple)?(-additive)?$/.test(n),p=/^multi(ple)?-additive/.test(n),q=f.selectionModelSelectedAttribute||h,r=f.selectionModelSelectedClass||i,s=f.selectionModelCleanupStrategy||l,t=f.ngRepeat;if(!t)throw"selectionModel must be used along side ngRepeat";var u=d.$eval(f.selectionModelSelectedItems),v=function(){if(!o)return null;var a="data-selection-model-stack-id",c=e.attr(a);return c?c:(c=e.parent().attr(a))?(e.attr(a,c),c):(c=b.create(),e.attr(a,c),e.parent().attr(a,c),c)}(),w=t.split(" in "),x=d.$eval(w[0]),y=function(){if(x[q]?e.addClass(r):e.removeClass(r),"checkbox"===m){var a=e.find("input");a.prop("checked",x[q])}},z=function(){return d.$eval(w[1])},A=function(){return d.$eval(w[1].split("|")[0])},B=function(){angular.forEach(A(),function(a){a[q]=!1}),angular.isArray(u)&&(u.length=0)},C=function(a){var b=(z(),!1),c=!1;a=a||x,angular.forEach(z(),function(d){c=c||d===x,b=b||d===a;var e=b+c===1;(e||d===x||d===a)&&(d[q]=!0)})},D=function(b){var c=b.ctrlKey||b.metaKey||p,e=b.shiftKey,f=b.target||b.srcElement,g="checkbox"===m&&"INPUT"===f.tagName&&"checkbox"===f.type;if(g&&b.stopPropagation(),e&&o&&!g)return c||d.$apply(B),C(a.peek(v)),void d.$apply();if(c||e||g){var h=!x[q];return o||B(),x[q]=h,x[q]&&a.push(v,x),void d.$apply()}B(),d.$apply(),x[q]=!0,a.push(v,x),d.$apply()},E=function(){if(angular.isArray(u)){var a=u.indexOf(x);x[q]?-1===a&&u.push(x):a>-1&&u.splice(a,1)}};if(e.on("click",D),"checkbox"===m){var F=e.find("input");F[0]&&"checkbox"===F[0].type&&e.find("input").on("click",D)}y(),"deselect"===s&&d.$on("$destroy",function(){x[q]=!1,E()}),d.$watch(w[0]+"."+q,function(a,b){o||!a||b||(B(),x[q]=!0),E(),y()})}}}]),angular.module("selectionModel").provider("selectionModelOptions",[function(){"use strict";var a={selectedAttribute:"selected",selectedClass:"selected",type:"basic",mode:"single",cleanupStrategy:"none"};this.set=function(b){angular.extend(a,b)},this.$get=function(){var b={get:function(){return angular.copy(a)}};return b}}]),angular.module("selectionModel").service("selectionStack",function(){"use strict";var a={},b=1e3,c={};return a.push=function(a,d){c.hasOwnProperty(a)||(c[a]=[]);var e=c[a];for(e.push(d);e.length>b;)e.shift();return e.length},a.pop=function(a){c.hasOwnProperty(a)||(c[a]=[]);var b=c[a];return b.pop()},a.peek=function(a){c.hasOwnProperty(a)||(c[a]=[]);var b=c[a];return b.length?b[b.length-1]:void 0},a}),angular.module("selectionModel").service("uuidGen",function(){"use strict";var a={},b=["0","0","0"];return a.create=function(){for(var a,c=b.length;c;){if(c--,a=b[c].charCodeAt(0),57===a)return b[c]="A",b.join("");if(90!==a)return b[c]=String.fromCharCode(a+1),b.join("");b[c]="0"}return b.unshift("0"),b.join("")},a});